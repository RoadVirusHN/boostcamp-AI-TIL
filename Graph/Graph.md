[TOC]

# Graph

> 네이버 boostcamp AI Tech의 강의를 정리한 내용입니다

정점 집합과 간선 집합으로 이루어진 수학적 구조로, 다양한 복잡계(Complex Network)를 분석할 수 있는 언어

## Graph Introduction

### Graph란 무엇이고 왜 중요할까?

![image-20210222141300193](Graph.assets/image-20210222141300193.png)

**[img. 정점과 간선, 그래프의 그림]**

- 정점(Vertex) : 노드(Node)라고도 불림. 관계를 가지거나 가지지 않는 하나의 객체
- 간선(Edge): 링크(Link)라고도 불림. 두 개의 정점을 연결하는 선
- 그래프(Graph): 네트워크(Network)라고도 불림. 정점 집합과 간선 집합으로 이루어진 수학적 구조

우리의 주변에는 친구관계, 통신, 인터넷과 같은 *많은 구성 요소 간의 복잡한 상호작용*인 *복잡계(Complex System)*이 있으며, *그래프는 이 복잡계를 표현하고 분석하기 위한 언어*이다.

### 그래프 관련 인공지능 문제

1. 정점 분류(Node Classification) 문제 : 정점의 특성, 연결에 따라 분류할 수 있는가?
   - 트위터의 공유 관계를 분석하여 사용자의 정치적 성향 판단
2. 연결 예측(Link Prediction) 문제: 앞으로 그래프의 성장이 어떻게 될 것인가?
   - 페이스북 소셜 네트워크는 어떻게 진화할까?
3. 추천(Recommendation) 문제: 한 정점이 어떠한 경향으로 간선을 만드는가?
   - 상품, 영화 추천
4. 군집 분석(Community Detection) 문제: 연결 관계로부터 사회적 무리(Social Circle)을 찾아낼 수 있을까?
   - 연결 관계를 통한 가족 관계, 친구 관계, 대학 동기 들의 무리를 찾아내기
5. 랭킹(Ranking) 및 정보 검색(Information Retrieval) 문제: 그래프 내부에서 찾고 싶은 정점 찾기
   - 웹이라는 거대한 그래프로부터 찾고자 하는 웹페이지를 찾아내는 법
6. 정보 전파(Information Cascading) 및 바이럴 마케팅(Viral Marketing) 문제: 어떻게 최대한 간선을 통하여 전파 시킬 수 있는가?
   - 마케팅, 홍보 문제

### 그래프 관련 필수 기초 개념

#### 그래프의 유형 및 분류

| 명칭 | 무방향 그래프(Undirected Graph)                              | 방향 그래프(Directed Graph)                                  |
| ---- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 설명 | 간선엔 방향이 없는 그래프                                    | 간선엔 방향이 있는 그래프                                    |
| 예시 | 협업 관계 그래프, 페이스분 친구 그래프 등                    | 인용 그래프, 트위터 팔로우 그래프                            |
| 그림 | ![image-20210222144050997](Graph.assets/image-20210222144050997.png) | ![image-20210222143810589](Graph.assets/image-20210222143810589.png) |

**[fig. 방향성에 따른 그래프 분류]**

| 명칭 | 가중치가 없는 그래프(Unweighted Graph)                       | 가중치 그래프(Weighted Graph)                                |
| ---- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 설명 | 간선에 가중치가 없는 그래프                                  | 간선에 가중치가 있는 그래프                                  |
| 예시 | 웹 그래프, 페이스북 친구 그래프                              | 전화 그래프, 유사도 그래프                                   |
| 그림 | ![image-20210222144050997](Graph.assets/image-20210222144050997.png) | ![image-20210222144056996](Graph.assets/image-20210222144056996.png) |

**[fig. 가중치 여부에 따른 그래프 분류]**

| 명칭 | 동종 그래프(Unpartite Grpah)                                 | 이종 그래프(Bipartite Graph)                                 |
| ---- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 설명 | 동종 그래프는 단일 종류의 정점만 포함                        | 두 종류의 정점을 가지는 그래프, 다른 종류의 정점 사이에만 간선이 연결됨. |
| 예시 | 웹 그래프, 페이스북 친구 그래프                              | 전자 상거래 구매 내역(사용자, 상품), 영화 출연 그래프(배우, 영화) |
| 그림 | ![image-20210222144050997](Graph.assets/image-20210222144050997.png) | ![image-20210222144337862](Graph.assets/image-20210222144337862.png) |

**[fig. 정점의 종류에 따른 그래프 분류]**

![image-20210222145657789](Graph.assets/image-20210222145657789.png)

**[fig. 방향성이 없고 가중치가 있는 이종 그래프의 예시]**

#### 그래프 관련 필수 기초 개념

![image-20210222141300193](Graph.assets/image-20210222141300193.png)

**[img. 그래프]**

보통 정점들의 집합을 V, 간선들의 집합을 E, 그래프를 G = (V,E)로 표현

![image-20210222144646606](Graph.assets/image-20210222144646606.png)

**[img. 정점 1의 이웃 집합]**

정점의 이웃(Nieghbor)은 그 정점과 연결된 다른 정점을 의미하며 v의 이웃 집합을 보통 N(v) 혹은 $N_v$로 표기, 위 그림의 경우 N(1) = {2,5}

![image-20210222144752469](Graph.assets/image-20210222144752469.png)

**[img. 방향 그래프에서의 이웃]**

방향성이 있는 그래프에서는 나가는 이웃과 들어오는 이웃을 구분하며,

- 정점 v에서 간선이 나가는 이웃(Out-Neighbor)의 집합을 보통 $N_{out}(v)$로 표기
- 정점 v에서 간선이 들어오는 이웃(In-Neighbor)의 집합을 보통 $N_{in}(v)$로 표기
- 그림의 경우, $N_{out}(5)=\{1,2\},\ N_{in}(4)=\{3\}$

### 그래프의 표현 및 저장

- NetworkX 그래프 Vis 코드 + 간선 저장 코드의 경우 LAB의 [Graph-1]Grpah_Basic.ipynb 참조

1. 간선 리스트(Edge List) : 그래프를 간선들의 리스트로 저장
   - 정점 간의 간선 유무를 알아보기 위해 모든 리스트를 다 확인해봐야함, 성능상 비효율적임.

| 무방향성                                                     | 방향성                                                       |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| ![image-20210222151617561](Graph.assets/image-20210222151617561.png) | ![image-20210222151626677](Graph.assets/image-20210222151626677.png) |
| 간선이 연결하는 두 정점들의 순서쌍(Pair)로 저장              | 방향성이 있는 경우에는 (출발점, 도착점) 순서로 저장          |

**[fig. 간선리스트의 예시]**

2. 인접 리스트(Adjacent list) : 정점들의 이웃들을 리스트로 저장
   - 간선 리스트에 비해 성능상 효율적임

| 그래프    | 도식                                                         | 설명                                                         |
| --------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 무 방향성 | ![image-20210222151902445](Graph.assets/image-20210222151902445.png) | 각 정점의 이웃들을 리스트로 저장                             |
| 방향성    | ![image-20210222151910261](Graph.assets/image-20210222151910261.png) | 각 정점의 나가는 이웃들과 들어오는 이웃들을 각각 리스트로 저장 |

**[fig. 인접리스트의 예시]**

3. 인접 행렬(Adjacency Matrix)
   - 연산 성능 상 문제 없고 구현이 쉽지만 메모리 낭비가 심하다.

| 무방향성                                                     | 방향성                                                       |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| ![image-20210222152218110](Graph.assets/image-20210222152218110.png) | ![image-20210222152230165](Graph.assets/image-20210222152230165.png) |
| 정점 수 $\times$ 정점 수 크기의 행렬                         | 정점 수 $\times$ 정점 수 크기의 행렬                         |
| 정점 i 와 j 사이에 간선이 있는 경우, 행렬 (i, j) 그리고 (j, i) 원소가 1 없는 경우 0 | 정점 i 에서  j 로 가는 간선이 있는 경우, 행렬 (i, j)가 1 없는 경우 0, 반대로, 정점 j에서 i로 가는 간선이 있는 경우, 행렬 (j,i)가 1 없는 경우 0 |

**[fig. 인접 행렬의 예시]**

## 그래프를 이용한 기계학습

### 실제 그래프 vs 랜덤 그래프

실제 그래프(Real Graph)란 다양한 복잡계로 부터 얻어진 그래프를 의미

![image-20210222192758719](Graph.assets/image-20210222192758719.png)

**[img. 실제 그래프의 예]**

랜덤 그래프(Random Graph)는 확률적 과정을 통해 생성한 그래프를 의미

- 에되스-레니 랜덤 그래프(Erdos-Renyi Random Graph) : $G(n,p)$
  - n 개의 정점을 가짐
  - 임의의 두 개의 정점 사이에 간선이 존재할 확률은 p, 모든 정점 사이가 동일함
  - 정점 간의 연결은 서로 독립적(Independent)

![image-20210222193740697](Graph.assets/image-20210222193740697.png)

**[img. $G(3,0.3)$일때 생성될 수 있는 그래프와 확률]**

### 작은 세상 효과

| 개념                       | 설명                                                         |
| -------------------------- | ------------------------------------------------------------ |
| 경로(Path)                 | 첫번째로 u에서 시작해서 정점 v에서 끝나야 하며, 두번째로, 순열에서 연속된 정점은 간선으로 연결되어 있어야 함. |
| 경로의 길이                | 경로 상에 놓이는 간선의 수로 정의됨                          |
| 정점 사이의 거리(Distance) | u와 v 사이의 최단 경로의 길이                                |
| 최단 경로(Shortest Path)   | u와 v사이의 거리가 최소가 되는 경로                          |
| 그래프 지름(Diameter)      | 정점 간 거리의 최댓값                                        |

**[fig. 그래프의 개념 설명]**

|     그래프     | ![image-20210222195559001](Graph.assets/image-20210222195559001.png) |
| :------------: | :----------------------------------------------------------: |
|   경로 예시    | 정점 1과 8사이의 경로는 [1,4,6,8], [1,3,4,6,8],[1,4,3,4,6,8] |
| 경로 길이 예시 |                 경로 [1,3,4,6,8]의 길이는 4                  |
|   거리 예시    |      정점 1과 8 사이의 최단 경로는 [1,4,6,8]로 거리는 3      |
|   지름 예시    |                      정점 2에서 8까지 4                      |

**[fig. 그래프의 개념 예시]**

*작은 세상 효과(Small-world Effect)* : 실제 그래프의 임의의 두 정점 사이의 거리는 생각보다 작다.

- 여섯 단계 분리(Six Degrees of Separation) 실험에서 6단계 만에 오마하에서 보스턴까지 편지를 전달 
- MSN 메신저 사용자의 평균 거리는 7
- 랜덤 그래프에도 존재하지만 체인(Chain), 사이클(Cycle), 격자(Grid) 그래프에서는 작은 세상 효과가 존재 하지 않음.

![image-20210222210357371](Graph.assets/image-20210222210357371.png)

**[img. 작지 않은 세상들]**

### 연결성의 두터운-꼬리 분포

*정점의 연결성(Degree)*은 그 정점과 연결된 간선의 수, 해당 정점의 이웃들의 수를 의미

-  $d(v),\ d_v,\ |N(v)|$로 표기함.

|                      연결성                      |                            그래프                            |
| :----------------------------------------------: | :----------------------------------------------------------: |
| $d(1)=2\\d(2)=3\\d(3)=2\\d(4)=3\\d(5)=3\\d(6)=1$ | ![image-20210222211217384](Graph.assets/image-20210222211217384.png) |

**[fig. 연결성(이웃)의 예시]**

- 정점의 나가는 연결성(Out Degree)은 그 정점에서 나가는 간선의 수를 의미
  -  $d_{out}(v), |N_{out}(v)|$로 표시

- 정점의 들어오는 연결성(In Degree)은 그 정점에서 들어오는 간선의 수를 의미.
  -  $d_{in}(v), |N_{in}(v)|$로 표시

|                            연결성                            |                            그래프                            |
| :----------------------------------------------------------: | :----------------------------------------------------------: |
| $d_{in}(1)=1,\ d_{out}(1)=1\\d_{in}(2)=3,\ d_{out}(1)=1\\d_{in}(3)=0,\ d_{out}(3)=2\\d_{in}(4)=1,\ d_{out}(4)=2\\d_{in}(5)=2,\ d_{out}(5)=2\\d_{in}(6)=4,\ d_{out}(6)=0\\$ | ![image-20210222211457071](Graph.assets/image-20210222211457071.png) |

**[fig. 방향 그래프의 연결성(이웃)의 예시]**



실제 그래프의 연결성 분포는 두터운 꼬리(Heavy Tail)를 가짐 (ex)BTS와 강사님의 트위터 팔로워 수)

- 이는 연결성이 매우 높은 허브(Hub) 정점이 존재함을 의미.

반면에 랜덤 그래프의 연결성 분포는 정규분포와 유사함(ex) 인간의 키 분포).

- 허브 정점이 존재할 확률이 아주 적음.

![image-20210222205312523](Graph.assets/image-20210222205312523.png)

**[img. 랜덤 그래프와 실제 그래프의 차이]**

### 거대 연결 요소

연결 요소(Connected Component)는 다음 조건들을 만족하는 정점들의 집합을 의미합니다.

1. 연결 요소에 속하는 정점들은 경로로 연결될 수 있습니다.
2. 1.의 조건을 만족하면서 정점을 추가할 수 없습니다.

![image-20210222211033248](Graph.assets/image-20210222211033248.png)

**[img. {1,2,3,4,5}, {6,7,8}, {9} 총 3개의 연결 요소가 있다.]**

실제 그래프에는 거대 연결요소(Giant Connected Component)가 존재하며, 대다수의 정점을 포함함.

랜덤 그래프에도 높은 확률로 거대 연결요소가 존재함.

- 단, Random Graph Theory에 의해 정점들의 평균 연결성이 1보다 충분히 커야함.

|                         실제 그래프                          |                         랜덤 그래프                          |
| :----------------------------------------------------------: | :----------------------------------------------------------: |
| ![image-20210222211840067](Graph.assets/image-20210222211840067.png) | ![image-20210222211957262](Graph.assets/image-20210222211957262.png) |

**[fig. 실제 그래프 vs 랜덤 그래프에서의 거대 연결 요소]**

### 군집 구조

군집(Community)이란 다음과 같은 조건을 만족하는 정점들의 집합.

1. 집합에 속하는 정점 사이에는 많은 간선이 존재함
2. 집합에 속하는 정점과 그렇지 않은 정점 사이에는 적은 수의 간선이 존재

![image-20210222212438460](Graph.assets/image-20210222212438460.png)

**[img. 군집 그래프]**

*지역적 군집 계수(Local Clustering Coefficient)*는 한 정점에서 군집의 형성 정도를 측정 가능

- 정점 $i$의 지역적 군집 계수($C_i$)는 정점 $i$의 이웃들의 쌍 중 간선으로 직접 연결된 것의 비율을 의미
- 연결성(이웃)이 0인 정점에서는 지역적 군집 계수 정의가 안됨.

![image-20210222213514347](Graph.assets/image-20210222213514347.png)

**[img. 지역적 군집 계수의 예시]**



*전역 군집 계수(Global Clustering Coefficient)*는 전체 그래프에서 군집의 형성 정도를 측정

- 그래프 G의 전역 군집 계수는 각 정점에서의 지역적 군집 계수의 평균
  - 단, 지역적 군집 계수가 정의되지 않는 정점은 제외



실제 그래프에서 군집 계수가 높은(=군집이 많은) 이유

1. 동질성(Homophily) : 서로 유사한 정점끼리 간선으로 연결될 가능성이 높음
   - 같은 인종간 관계 그래프
2. 전이성(Transitivity) : 공통 이웃은 간선 연결이 생길 확률이 높음
   - 친구에게 친구를 소개



반면 랜덤 그래프는 간선 연결 확률이 독립적(Independent)이므로 지역적, 전역 군집 계수가 높지 않음.

### 군집 계수 및 지름 분석

- [Graph-2]Graph_Property.ipynb 참조

|           | 균일 그래프(Regular Graph) | 작은 세상 그래프(Small-world Graph) | 랜덤 그래프(Random Graph) |
| --------- | -------------------------- | ----------------------------------- | ------------------------- |
| 군집 계수 | 큼                         | 큼                                  | 작음                      |
| 지름      | 큼                         | 작음                                | 큼                        |

